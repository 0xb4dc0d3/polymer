<script>
  (function() {
    var instrumentedMethods = [
      'attachedCallback',
      'detachedCallback',
      'createdCallback',
      '_ready',
      '_registerFeatures',
      '_finishRegisterFeatures',
      '_prepBehavior',
      '_initFeatures',
      '_marshalBehavior',
      '_stampTemplate',
    ];

    function instrument(name, fn) {
      var count = 0;
      return function() {
        var start = this.is + '-' + name + '-start-' + count;
        var end = this.is + '-' + name + '-end-' + count;

        ++count;

        performance.mark(start);
        var result = fn.apply(this, arguments);
        performance.mark(end);
        performance.measure(this.is + '::' + name, start, end);
      }
    }

    var UserTiming = instrumentedMethods.reduce(function(proto, method) {
      proto[method] = instrument(method, Polymer.Base[method]);
      return proto;
    }, {});

    Polymer.Base._addFeature(UserTiming);
  })();
</script>
